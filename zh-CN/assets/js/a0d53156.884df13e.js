"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[3104],{91615:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var r=a(85893),i=a(11151);const l={title:"\u53c2\u6570\u4fee\u6539\u5668"},d=void 0,s={id:"resource/devtool-plugins/payload-modifier",title:"\u53c2\u6570\u4fee\u6539\u5668",description:"\u4ecb\u7ecd",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/resource/04-devtool-plugins/03-payload-modifier.md",sourceDirName:"resource/04-devtool-plugins",slug:"/resource/devtool-plugins/payload-modifier",permalink:"/zh-CN/resource/devtool-plugins/payload-modifier",draft:!1,unlisted:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/resource/04-devtool-plugins/03-payload-modifier.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"\u53c2\u6570\u4fee\u6539\u5668"},sidebar:"resource",previous:{title:"tags\u4fee\u6539\u5668",permalink:"/zh-CN/resource/devtool-plugins/tag-modifier"},next:{title:"API\u8fc7\u6ee4\u5668",permalink:"/zh-CN/resource/devtool-plugins/filter-api"}},o={},c=[{value:"\u4ecb\u7ecd",id:"\u4ecb\u7ecd",level:2},{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528",level:2},{value:"\u914d\u7f6e\u53c2\u6570",id:"\u914d\u7f6e\u53c2\u6570",level:2},{value:"\u7c7b\u578b\u5b9a\u4e49",id:"\u7c7b\u578b\u5b9a\u4e49",level:3},{value:"\u793a\u4f8b\u914d\u7f6e",id:"\u793a\u4f8b\u914d\u7f6e",level:3},{value:"\u4fee\u6539\u53c2\u6570\u7c7b\u578b",id:"\u4fee\u6539\u53c2\u6570\u7c7b\u578b",level:4},{value:"\u4fee\u6539\u5d4c\u5957\u53c2\u6570",id:"\u4fee\u6539\u5d4c\u5957\u53c2\u6570",level:4},{value:"\u79fb\u9664\u53c2\u6570",id:"\u79fb\u9664\u53c2\u6570",level:4},{value:"\u8054\u5408\u7c7b\u578b",id:"\u8054\u5408\u7c7b\u578b",level:4},{value:"\u9ad8\u7ea7\u7528\u6cd5",id:"\u9ad8\u7ea7\u7528\u6cd5",level:2},{value:"\u52a8\u6001\u4fee\u6539\u5fc5\u586b\u6027",id:"\u52a8\u6001\u4fee\u6539\u5fc5\u586b\u6027",level:3},{value:"\u53ef\u9009\u53c2\u6570\u4e0e\u5fc5\u586b\u53c2\u6570",id:"\u53ef\u9009\u53c2\u6570\u4e0e\u5fc5\u586b\u53c2\u6570",level:3},{value:"\u4f7f\u7528\u6b63\u5219\u5339\u914d",id:"\u4f7f\u7528\u6b63\u5219\u5339\u914d",level:3},{value:"\u652f\u6301 <code>oneOf</code>\u3001<code>anyOf</code>\u3001<code>allOf</code>",id:"\u652f\u6301-oneofanyofallof",level:3}];function t(n){const e={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h2,{id:"\u4ecb\u7ecd",children:"\u4ecb\u7ecd"}),"\n",(0,r.jsxs)(e.p,{children:["\u672c\u63d2\u4ef6\u7528\u4e8e\u7075\u6d3b\u4fee\u6539 API \u63a5\u53e3\u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u53c2\u6570\uff0c\u652f\u6301\u589e\u52a0\u3001\u5220\u9664\u3001\u4fee\u6539\u53c2\u6570\u7c7b\u578b\uff0c\u4ee5\u53ca\u901a\u8fc7 ",(0,r.jsx)(e.code,{children:"flat"})," \u4fee\u6539\u53c2\u6570\u5c42\u7ea7\u3002"]}),"\n",(0,r.jsx)(e.p,{children:"\u4e3b\u8981\u529f\u80fd\u5305\u62ec\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u652f\u6301\u5bf9 ",(0,r.jsx)(e.code,{children:"params"}),"\u3001",(0,r.jsx)(e.code,{children:"pathParams"}),"\u3001",(0,r.jsx)(e.code,{children:"data"}),"\u3001",(0,r.jsx)(e.code,{children:"response"})," \u8303\u56f4\u7684\u53c2\u6570\u8fdb\u884c\u4fee\u6539"]}),"\n",(0,r.jsxs)(e.li,{children:["\u652f\u6301\u901a\u8fc7\u53c2\u6570\u540d\u5339\u914d\u89c4\u5219\uff08",(0,r.jsx)(e.code,{children:"match"}),"\uff09\u7cbe\u786e\u63a7\u5236\u4fee\u6539\u8303\u56f4"]}),"\n",(0,r.jsxs)(e.li,{children:["\u652f\u6301\u901a\u8fc7 ",(0,r.jsx)(e.code,{children:"handler"})," \u51fd\u6570\u52a8\u6001\u4fee\u6539\u53c2\u6570\u7c7b\u578b\u548c\u5fc5\u586b\u6027"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u57fa\u672c\u4f7f\u7528",children:"\u57fa\u672c\u4f7f\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",metastring:'title="alova.config.js"',children:"import { defineConfig } from '@alova/wormhole';\nimport { payloadModifier } from '@alova/wormhole/plugin';\n\nexport default defineConfig({\n  generator: [\n    {\n      // ...\n      plugin: [\n        // \u4fee\u6539\u8bf7\u6c42\u53c2\u6570\u4e2d\u7684 `userId` \u5b57\u6bb5\n        payloadModifier([\n          {\n            scope: 'params',\n            match: key => key === 'userId',\n            handler: schema => {\n              return {\n                'attr1?': 'string', // \u751f\u6210\u4e3a\u53ef\u9009\u53c2\u6570\n                attr2: 'number', // \u751f\u6210\u4e3a\u5fc5\u586b\u53c2\u6570\n                attr3: {\n                  // \u5d4c\u5957\u6570\u636e\n                  innerAttr: ['string', 'number', 'boolean']\n                }\n              };\n            }\n          }\n        ])\n      ]\n    }\n  ]\n});\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u914d\u7f6e\u53c2\u6570",children:"\u914d\u7f6e\u53c2\u6570"}),"\n",(0,r.jsx)(e.h3,{id:"\u7c7b\u578b\u5b9a\u4e49",children:"\u7c7b\u578b\u5b9a\u4e49"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-typescript",children:"/**\n * \u53c2\u6570\u4fee\u6539\u8303\u56f4\n */\ntype ModifierScope = 'params' | 'pathParams' | 'data' | 'response';\n\n/**\n * \u57fa\u672c\u7c7b\u578b\n */\ntype SchemaPrimitive =\n  | 'number'\n  | 'string'\n  | 'boolean'\n  | 'undefined'\n  | 'null'\n  | 'unknown'\n  | 'any'\n  | 'never';\n\n/**\n * \u6570\u7ec4\u7c7b\u578b\n */\ntype SchemaArray = {\n  type: 'array';\n  items: Schema;\n};\n\n/**\n * \u5f15\u7528\u7c7b\u578b\uff08\u53ef\u9009\u53c2\u6570\u901a\u8fc7\u5728 key \u672b\u7aef\u6dfb\u52a0 `?` \u8868\u793a\uff09\n */\ntype SchemaReference = {\n  [attr: string]: Schema;\n};\n\n/**\n * \u6570\u636e Schema\uff08\u652f\u6301\u8054\u5408\u7c7b\u578b\uff09\n */\ntype Schema =\n  | SchemaPrimitive\n  | SchemaReference\n  | SchemaArray\n  | Array<SchemaPrimitive | SchemaReference | SchemaArray>\n  | { oneOf: Schema[] }\n  | { anyOf: Schema[] }\n  | { allOf: Schema[] };\n\n/**\n * \u914d\u7f6e\u63a5\u53e3\n */\ninterface Config<T extends Schema> {\n  /**\n   * \u751f\u6548\u8303\u56f4\n   */\n  scope: ModifierScope;\n\n  /**\n   * \u5339\u914d\u89c4\u5219\n   * - string: \u539f\u53c2\u6570\u540d\u5305\u542b\u6b64\u5b57\u7b26\u4e32\n   * - RegExp: \u539f\u53c2\u6570\u540d\u5339\u914d\u6b64\u6b63\u5219\n   * - function: \u81ea\u5b9a\u4e49\u5339\u914d\u51fd\u6570\n   */\n  match?: string | RegExp | ((key: string) => boolean);\n\n  /**\n   * \u53c2\u6570\u4fee\u6539\u5904\u7406\u5668\n   * @param schema \u5f53\u524d\u53c2\u6570\u7684 Schema\n   * @returns \u8fd4\u56de\u591a\u79cd\u53c2\u6570\uff0c\u5177\u4f53\u4e3a\uff1aSchema\u8868\u793a\u4fee\u6539\u7684\u7c7b\u578b\uff1b\n   * { required: boolean, value: Schema }\u8868\u793a\u53ef\u5c06\u5f53\u524d\u503c\u4fee\u6539\u4e3a\u662f\u5426\u5fc5\u586b\uff1b\n   * void | null | undefined\u8868\u793a\u79fb\u9664\u5f53\u524d\u5b57\u6bb5\n   */\n  handler: (\n    schema: T\n  ) => Schema | { required: boolean; value: Schema } | void | null | undefined;\n}\n\n/**\n * \u63d2\u4ef6\u51fd\u6570\n */\nfunction payloadModifier(configs: Config<Schema>[]): ApiPlugin;\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u793a\u4f8b\u914d\u7f6e",children:"\u793a\u4f8b\u914d\u7f6e"}),"\n",(0,r.jsx)(e.h4,{id:"\u4fee\u6539\u53c2\u6570\u7c7b\u578b",children:"\u4fee\u6539\u53c2\u6570\u7c7b\u578b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"// \u5c06 `params` \u4e2d\u7684 `age` \u5b57\u6bb5\u4fee\u6539\u4e3a `number` \u7c7b\u578b\npayloadModifier([\n  {\n    scope: 'params',\n    match: 'age',\n    handler: () => 'number'\n  }\n]);\n"})}),"\n",(0,r.jsx)(e.h4,{id:"\u4fee\u6539\u5d4c\u5957\u53c2\u6570",children:"\u4fee\u6539\u5d4c\u5957\u53c2\u6570"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"// \u4fee\u6539 `data` \u4e2d\u7684\u5d4c\u5957\u53c2\u6570\npayloadModifier([\n  {\n    scope: 'data',\n    match: 'user',\n    handler: () => ({\n      name: 'string',\n      age: 'number',\n      address: {\n        city: 'string',\n        zipCode: 'number'\n      }\n    })\n  }\n]);\n"})}),"\n",(0,r.jsx)(e.h4,{id:"\u79fb\u9664\u53c2\u6570",children:"\u79fb\u9664\u53c2\u6570"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"// \u79fb\u9664 `response` \u4e2d\u7684 `debugInfo` \u5b57\u6bb5\npayloadModifier([\n  {\n    scope: 'response',\n    match: 'debugInfo',\n    handler: () => undefined\n  }\n]);\n"})}),"\n",(0,r.jsx)(e.h4,{id:"\u8054\u5408\u7c7b\u578b",children:"\u8054\u5408\u7c7b\u578b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"// \u5c06 `pathParams` \u4e2d\u7684 `id` \u5b57\u6bb5\u4fee\u6539\u4e3a `string | number` \u7c7b\u578b\npayloadModifier([\n  {\n    scope: 'pathParams',\n    match: 'id',\n    handler: () => ['string', 'number']\n  }\n]);\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u9ad8\u7ea7\u7528\u6cd5",children:"\u9ad8\u7ea7\u7528\u6cd5"}),"\n",(0,r.jsx)(e.h3,{id:"\u52a8\u6001\u4fee\u6539\u5fc5\u586b\u6027",children:"\u52a8\u6001\u4fee\u6539\u5fc5\u586b\u6027"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"// \u5c06 `data` \u4e2d\u7684 `email` \u5b57\u6bb5\u4fee\u6539\u4e3a\u5fc5\u586b\npayloadModifier([\n  {\n    scope: 'data',\n    match: 'email',\n    handler: () => ({ required: true, value: 'string' })\n  }\n]);\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u53ef\u9009\u53c2\u6570\u4e0e\u5fc5\u586b\u53c2\u6570",children:"\u53ef\u9009\u53c2\u6570\u4e0e\u5fc5\u586b\u53c2\u6570"}),"\n",(0,r.jsxs)(e.p,{children:["\u5728 ",(0,r.jsx)(e.code,{children:"SchemaReference"})," \u4e2d\uff0c\u901a\u8fc7\u5728\u53c2\u6570\u540d\u672b\u5c3e\u6dfb\u52a0 ",(0,r.jsx)(e.code,{children:"?"})," \u8868\u793a\u53ef\u9009\u53c2\u6570\uff0c\u5426\u5219\u4e3a\u5fc5\u586b\u53c2\u6570\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"// \u5c06 `data` \u4e2d\u7684 `username` \u8bbe\u4e3a\u5fc5\u586b\uff0c`age` \u8bbe\u4e3a\u53ef\u9009\npayloadModifier([\n  {\n    scope: 'data',\n    match: 'user',\n    handler: () => ({\n      username: 'string', // \u5fc5\u586b\u53c2\u6570\n      'age?': 'number' // \u53ef\u9009\u53c2\u6570\n    })\n  }\n]);\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u4f7f\u7528\u6b63\u5219\u5339\u914d",children:"\u4f7f\u7528\u6b63\u5219\u5339\u914d"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"// \u4fee\u6539\u6240\u6709\u4ee5 `_date` \u7ed3\u5c3e\u7684\u53c2\u6570\u4e3a `string` \u7c7b\u578b\npayloadModifier([\n  {\n    scope: 'params',\n    match: /_date$/,\n    handler: () => 'string'\n  }\n]);\n"})}),"\n",(0,r.jsxs)(e.h3,{id:"\u652f\u6301-oneofanyofallof",children:["\u652f\u6301 ",(0,r.jsx)(e.code,{children:"oneOf"}),"\u3001",(0,r.jsx)(e.code,{children:"anyOf"}),"\u3001",(0,r.jsx)(e.code,{children:"allOf"})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"// \u4f7f\u7528\u6570\u7ec4\u5b9a\u4e49\u591a\u9009\u4e00\u53c2\u6570\npayloadModifier([\n  {\n    scope: 'data',\n    match: 'paymentMethod',\n    handler: () => ([\n      { type: 'string', cardNumber: 'string' },\n      { type: 'number', email: 'string' }\n    ])\n  }\n]);\n\n// \u4f7f\u7528 `oneOf` \u5b9a\u4e49\u591a\u9009\u4e00\u53c2\u6570\npayloadModifier([\n  {\n    scope: 'data',\n    match: 'paymentMethod',\n    handler: () => ({\n      oneOf: [\n        { type: 'string', cardNumber: 'string' },\n        { type: 'number', email: 'string' }\n      ]\n    })\n  }\n]);\n\n// \u4f7f\u7528 `anyOf` \u5b9a\u4e49\u53ef\u9009\u53c2\u6570\u7ec4\u5408\npayloadModifier([\n  {\n    scope: 'data',\n    match: 'contactMethod',\n    handler: () => ({\n      anyOf: [\n        { email: 'string', value: 'string' },\n        { phone: 'string', value: 'number' }\n      ]\n    })\n  }\n]);\n\n// \u4f7f\u7528 `allOf` \u5b9a\u4e49\u53c2\u6570\u7ec4\u5408\npayloadModifier([\n  {\n    scope: 'data',\n    match: 'userProfile',\n    handler: () => ({\n      allOf: [{ name: 'string' }, { age: 'number' }]\n    })\n  }\n]);\n"})})]})}function h(n={}){const{wrapper:e}={...(0,i.a)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(t,{...n})}):t(n)}},11151:(n,e,a)=>{a.d(e,{Z:()=>s,a:()=>d});var r=a(67294);const i={},l=r.createContext(i);function d(n){const e=r.useContext(l);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:d(n.components),r.createElement(l.Provider,{value:e},n.children)}}}]);