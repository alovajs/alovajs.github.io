"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[3243],{41115:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var t=r(85893),s=r(11151);const i={title:"\u539f\u5b50\u5316\u8bf7\u6c42"},l=void 0,a={id:"tutorial/server/strategy/atomize",title:"\u539f\u5b50\u5316\u8bf7\u6c42",description:"server hook",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/tutorial/04-server/01-strategy/04-atomize.md",sourceDirName:"tutorial/04-server/01-strategy",slug:"/tutorial/server/strategy/atomize",permalink:"/zh-CN/tutorial/server/strategy/atomize",draft:!1,unlisted:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/tutorial/04-server/01-strategy/04-atomize.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"\u539f\u5b50\u5316\u8bf7\u6c42"},sidebar:"tutorial",previous:{title:"\u8bf7\u6c42\u901f\u7387\u9650\u5236",permalink:"/zh-CN/tutorial/server/strategy/rate-limit"},next:{title:"\u54cd\u5e94\u7f13\u5b58\u8be6\u89e3",permalink:"/zh-CN/tutorial/cache/"}},o={},c=[{value:"\u7279\u6027",id:"\u7279\u6027",level:2},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",level:2},{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:3},{value:"\u81ea\u5b9a\u4e49\u9501\u901a\u9053",id:"\u81ea\u5b9a\u4e49\u9501\u901a\u9053",level:3},{value:"\u81ea\u5b9a\u4e49\u8d85\u65f6\u65f6\u95f4\u548c\u95f4\u9694",id:"\u81ea\u5b9a\u4e49\u8d85\u65f6\u65f6\u95f4\u548c\u95f4\u9694",level:3},{value:"\u9519\u8bef\u5904\u7406",id:"\u9519\u8bef\u5904\u7406",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.admonition,{title:"type",type:"info",children:[(0,t.jsx)(n.p,{children:"server hook"}),(0,t.jsx)(n.p,{children:"alova@3.4.0+"})]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"atomize\u7b56\u7565\u53ef\u7528\u4e8e\u786e\u4fdd\u591a\u8fdb\u7a0b\u73af\u5883\u4e2d\u7684\u8bf7\u6c42\u539f\u5b50\u6027\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u7279\u6027",children:"\u7279\u6027"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u786e\u4fdd\u591a\u8fdb\u7a0b\u73af\u5883\u4e2d\u7684\u8bf7\u6c42\u539f\u5b50\u6027\uff1b"}),"\n",(0,t.jsx)(n.li,{children:"\u53ef\u81ea\u5b9a\u4e49\u9501\u901a\u9053\u3001\u8d85\u65f6\u65f6\u95f4\u548c\u91cd\u8bd5\u95f4\u9694\uff1b"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u4f7f\u7528",children:"\u4f7f\u7528"}),"\n",(0,t.jsx)(n.h3,{id:"\u57fa\u672c\u7528\u6cd5",children:"\u57fa\u672c\u7528\u6cd5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const { atomize } = require('alova/server');\nconst { alovaInstance } = require('./api');\n\nconst res = await atomize(alovaInstance.Get('/api/user'));\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c",(0,t.jsx)(n.code,{children:"atomize"}),"\u4f7f\u7528\u901a\u9053\u540d",(0,t.jsx)(n.code,{children:"'default'"}),"\uff0c\u8d85\u65f6\u65f6\u95f4\u4e3a",(0,t.jsx)(n.code,{children:"5000ms"}),"\uff0c\u91cd\u8bd5\u95f4\u9694\u4e3a",(0,t.jsx)(n.code,{children:"100ms"}),"\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49\u9501\u901a\u9053",children:"\u81ea\u5b9a\u4e49\u9501\u901a\u9053"}),"\n",(0,t.jsx)(n.p,{children:"\u53ef\u4ee5\u6307\u5b9a\u81ea\u5b9a\u4e49\u901a\u9053\u540d\u6216\u901a\u9053\u540d\u6570\u7ec4\u8fdb\u884c\u9501\u5b9a\uff0c\u4e0d\u540c\u7684\u901a\u9053\u4e92\u4e0d\u5f71\u54cd\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const hookedMethod = atomize(request, {\n  // highlight-start\n  // \u8bbe\u7f6e\u81ea\u5b9a\u4e49\u901a\u9053\u540d\n  channel: 'user_lock'\n  // \u6216\u591a\u4e2a\u901a\u9053\n  // channel: ['user_lock', 'order_lock']\n  // highlight-end\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49\u8d85\u65f6\u65f6\u95f4\u548c\u95f4\u9694",children:"\u81ea\u5b9a\u4e49\u8d85\u65f6\u65f6\u95f4\u548c\u95f4\u9694"}),"\n",(0,t.jsx)(n.p,{children:"\u53ef\u4ee5\u8c03\u6574\u83b7\u53d6\u9501\u7684\u8d85\u65f6\u65f6\u95f4\u548c\u91cd\u8bd5\u95f4\u9694\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const hookedMethod = atomize(request, {\n  // highlight-start\n  // \u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u4e3a10\u79d2\n  timeout: 10000,\n  // \u8bbe\u7f6e\u91cd\u8bd5\u95f4\u9694\u4e3a200ms\n  interval: 200\n  // highlight-end\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"}),"\n",(0,t.jsx)(n.p,{children:"\u5982\u679c\u5728\u6307\u5b9a\u8d85\u65f6\u65f6\u95f4\u5185\u65e0\u6cd5\u83b7\u53d6\u9501\uff0c\u5c06\u629b\u51fa\u9519\u8bef\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"try {\n  const response = await atomize(request);\n} catch (error) {\n  console.error('\u83b7\u53d6\u9501\u5931\u8d25:', error.message);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u6b64\u7b56\u7565\u9700\u8981\u4f7f\u7528",(0,t.jsx)(n.code,{children:"@alova/storage-redis"}),"\u6216",(0,t.jsx)(n.code,{children:"@alova/storage-file"}),"\u4f5c\u4e3aalova\u5b9e\u4f8b\u7684",(0,t.jsx)(n.code,{children:"l2Cache"}),"\u3002","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"@alova/storage-redis"}),"\u5185\u90e8\u4f7f\u7528",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/@sesamecare-oss/redlock",children:"@sesamecare-oss/redlock"}),"\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\uff0c\u53ef\u524d\u5f80",(0,t.jsx)(n.a,{href:"/resource/storage-adapter/redis",children:"redis\u5b58\u50a8\u9002\u914d\u5668"}),"\u67e5\u770bredlock\u7684\u914d\u7f6e\u65b9\u6cd5\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"@alova/storage-file"}),"\u5185\u90e8\u4f7f\u7528",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/proper-lockfile",children:"proper-lockfile"}),"\u5b9e\u73b0\u57fa\u4e8e\u6587\u4ef6\u7684\u9501\uff0c\u53ef\u524d\u5f80",(0,t.jsx)(n.a,{href:"/resource/storage-adapter/file",children:"file\u5b58\u50a8\u9002\u914d\u5668"}),"\u67e5\u770bproper-lockfile\u7684\u914d\u7f6e\u65b9\u6cd5\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"\u786e\u4fdd\u8bf7\u6c42\u5b8c\u6210\u540e\u91ca\u653e\u9501\uff0c\u907f\u514d\u6b7b\u9501\u3002"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>a,a:()=>l});var t=r(67294);const s={},i=t.createContext(s);function l(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);