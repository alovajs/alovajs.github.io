"use strict";(globalThis.webpackChunkalova_website=globalThis.webpackChunkalova_website||[]).push([[2292],{28453(e,n,r){r.d(n,{R:()=>c,x:()=>i});var a=r(96540);const s={},t=a.createContext(s);function c(e){const n=a.useContext(t);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),a.createElement(t.Provider,{value:n},e.children)}},45450(e,n,r){r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"tutorial/server/strategy/send-captcha","title":"\u5206\u5e03\u5f0f\u9a8c\u8bc1\u7801\u670d\u52a1","description":"server hook","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/tutorial/04-server/01-strategy/02-send-captcha.md","sourceDirName":"tutorial/04-server/01-strategy","slug":"/tutorial/server/strategy/send-captcha","permalink":"/zh-CN/tutorial/server/strategy/send-captcha","draft":false,"unlisted":false,"editUrl":"https://github.com/alovajs/alovajs.github.io/blob/main/docs/tutorial/04-server/01-strategy/02-send-captcha.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"\u5206\u5e03\u5f0f\u9a8c\u8bc1\u7801\u670d\u52a1"},"sidebar":"tutorial","previous":{"title":"\u8bf7\u6c42\u91cd\u8bd5\u7b56\u7565","permalink":"/zh-CN/tutorial/server/strategy/retry"},"next":{"title":"\u8bf7\u6c42\u901f\u7387\u9650\u5236","permalink":"/zh-CN/tutorial/server/strategy/rate-limit"}}');var s=r(74848),t=r(28453);const c={title:"\u5206\u5e03\u5f0f\u9a8c\u8bc1\u7801\u670d\u52a1"},i=void 0,d={},l=[{value:"\u7279\u6027",id:"\u7279\u6027",level:2},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",level:2},{value:"\u57fa\u7840\u7528\u6cd5",id:"\u57fa\u7840\u7528\u6cd5",level:3},{value:"\u8bbe\u7f6e\u9a8c\u8bc1\u7801\u5b58\u50a8\u5668",id:"\u8bbe\u7f6e\u9a8c\u8bc1\u7801\u5b58\u50a8\u5668",level:3},{value:"\u9a8c\u8bc1\u7801\u8fc7\u671f\u65f6\u95f4",id:"\u9a8c\u8bc1\u7801\u8fc7\u671f\u65f6\u95f4",level:3},{value:"\u9a8c\u8bc1\u7801\u91cd\u53d1\u95f4\u9694\u65f6\u95f4",id:"\u9a8c\u8bc1\u7801\u91cd\u53d1\u95f4\u9694\u65f6\u95f4",level:3},{value:"\u9a8c\u8bc1\u7801\u9632\u8986\u76d6",id:"\u9a8c\u8bc1\u7801\u9632\u8986\u76d6",level:3},{value:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801\u751f\u6210\u89c4\u5219",id:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801\u751f\u6210\u89c4\u5219",level:3},{value:"\u9884\u8bbe\u5b57\u7b26\u96c6\u548c\u957f\u5ea6",id:"\u9884\u8bbe\u5b57\u7b26\u96c6\u548c\u957f\u5ea6",level:4},{value:"\u5b8c\u5168\u81ea\u5b9a\u4e49\u751f\u6210\u903b\u8f91",id:"\u5b8c\u5168\u81ea\u5b9a\u4e49\u751f\u6210\u903b\u8f91",level:4},{value:"\u81ea\u5b9a\u4e49\u5b58\u50a8key\u524d\u7f00",id:"\u81ea\u5b9a\u4e49\u5b58\u50a8key\u524d\u7f00",level:3}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.admonition,{title:"\u7c7b\u578b",type:"info",children:(0,s.jsx)(n.p,{children:"server hook"})}),"\n",(0,s.jsx)(n.p,{children:"\u9a8c\u8bc1\u7801\u53d1\u9001\u548c\u6821\u9a8c\uff0c\u652f\u6301\u96c6\u7fa4\u7ba1\u7406\u9a8c\u8bc1\u7801\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u7279\u6027",children:"\u7279\u6027"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528\u7b80\u5355\uff1b"}),"\n",(0,s.jsx)(n.li,{children:"\u652f\u6301\u5355\u673a\u3001redis\u7b49\u96c6\u7fa4\u7ba1\u7406\u9a8c\u8bc1\u7801\uff1b"}),"\n",(0,s.jsx)(n.li,{children:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801\u6709\u6548\u65f6\u95f4\u548c\u91cd\u53d1\u95f4\u9694\u65f6\u95f4\uff1b"}),"\n",(0,s.jsx)(n.li,{children:"\u9a8c\u8bc1\u7801\u9632\u8986\u76d6\uff1b"}),"\n",(0,s.jsx)(n.li,{children:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801\u89c4\u5219\uff1b"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u4f7f\u7528",children:"\u4f7f\u7528"}),"\n",(0,s.jsx)(n.h3,{id:"\u57fa\u7840\u7528\u6cd5",children:"\u57fa\u7840\u7528\u6cd5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u521b\u5efa\nconst { sendCaptcha, verifyCaptcha } = createCaptchaProvider({\n  store: RedisAdapter()\n});\n\n// \u53d1\u9001\u9a8c\u8bc1\u7801\nconst key = '1234567890';\nawait sendCaptcha(\n  (code, mobile) => alova.Post('/sms/send', { code, mobile }),\n  // \u624b\u673a\u53f7\u4f5c\u4e3a\u5b58\u50a8\u952e\n  { key }\n);\n\n// \u9a8c\u8bc1\u9a8c\u8bc1\u7801\nconst captchaFromUserInput = '1234';\nconst isValid = await verifyCaptcha(captchaFromUserInput, key);\nconsole.log(isValid ? '\u9a8c\u8bc1\u901a\u8fc7' : '\u9a8c\u8bc1\u7801\u9519\u8bef');\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u8bbe\u7f6e\u9a8c\u8bc1\u7801\u5b58\u50a8\u5668",children:"\u8bbe\u7f6e\u9a8c\u8bc1\u7801\u5b58\u50a8\u5668"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u4f7f\u7528\u4e4b\u524d\uff0c\u9700\u8981\u901a\u8fc7",(0,s.jsx)(n.code,{children:"store"}),"\u914d\u7f6e\u8bbe\u7f6e\u9a8c\u8bc1\u7801\u7684\u5b58\u50a8\u5668\uff0c\u5b83\u662falova\u7684\u5b58\u50a8\u9002\u914d\u5668\uff0c\u5982\u679c\u662f\u5355\u673a\u4e0b\u53ef\u4ee5\u4f7f\u7528\u6587\u4ef6\u5b58\u50a8\u9002\u914d\u5668\u3001\u5206\u5e03\u5f0f\u96c6\u7fa4\u4e0b\u53ef\u4ee5\u4f7f\u7528redis\u9002\u914d\u5668\uff0c\u4f60\u53ef\u4ee5\u5728",(0,s.jsx)(n.a,{href:"/resource/storage-adapter",children:"\u5b58\u50a8\u9002\u914d\u5668"}),"\u4e2d\u9009\u62e9\u5408\u9002\u7684\u9002\u914d\u5668\uff0c\u4e5f\u53ef\u4ee5",(0,s.jsx)(n.a,{href:"/tutorial/advanced/custom/storage-adapter",children:"\u81ea\u5b9a\u4e49\u5b58\u50a8\u9002\u914d\u5668"}),"\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const redisAdapter = new RedisStorageAdapter({\n  host: 'localhost',\n  port: '6379',\n  username: 'default',\n  password: 'my-top-secret',\n  db: 0\n});\n\ncreateCaptchaProvider({\n  store: redisAdapter\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u9a8c\u8bc1\u7801\u8fc7\u671f\u65f6\u95f4",children:"\u9a8c\u8bc1\u7801\u8fc7\u671f\u65f6\u95f4"}),"\n",(0,s.jsxs)(n.p,{children:["\u901a\u8fc7",(0,s.jsx)(n.code,{children:"expireTime"}),"\u914d\u7f6e\u8bbe\u7f6e\u9a8c\u8bc1\u7801\u6709\u6548\u671f\uff0c\u5355\u4f4d\u6beb\u79d2\uff0c\u9ed8\u8ba4",(0,s.jsx)(n.code,{children:"300000"}),"\uff085\u5206\u949f\uff09\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"createCaptchaProvider({\n  expireTime: 10 * 60 * 1000\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u9a8c\u8bc1\u7801\u91cd\u53d1\u95f4\u9694\u65f6\u95f4",children:"\u9a8c\u8bc1\u7801\u91cd\u53d1\u95f4\u9694\u65f6\u95f4"}),"\n",(0,s.jsxs)(n.p,{children:["\u901a\u8fc7",(0,s.jsx)(n.code,{children:"resetTime"}),"\u914d\u7f6e\u8bbe\u7f6e\u9a8c\u8bc1\u7801\u91cd\u53d1\u95f4\u9694\u65f6\u95f4\uff0c\u5355\u4f4d\u6beb\u79d2\uff0c\u9ed8\u8ba4",(0,s.jsx)(n.code,{children:"60000"}),"\uff081\u5206\u949f\uff09\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"createCaptchaProvider({\n  resetTime: 5 * 60 * 1000\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u9a8c\u8bc1\u7801\u9632\u8986\u76d6",children:"\u9a8c\u8bc1\u7801\u9632\u8986\u76d6"}),"\n",(0,s.jsxs)(n.p,{children:["\u901a\u8fc7",(0,s.jsx)(n.code,{children:"resendFormStore"}),"\u914d\u7f6e\u8bbe\u7f6e\u662f\u5426\u4ece\u5b58\u50a8\u91cd\u65b0\u53d1\u9001\u5df2\u6709\u9a8c\u8bc1\u7801\uff0c\u9632\u6b62\u7528\u6237\u591a\u6b21\u53d1\u9001\u5bfc\u81f4\u9a8c\u8bc1\u7801\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"createCaptchaProvider({\n  // ...\n  resendFormStore: true\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801\u751f\u6210\u89c4\u5219",children:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u7801\u751f\u6210\u89c4\u5219"}),"\n",(0,s.jsxs)(n.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5c06\u4f1a\u751f\u62104\u4e3a0\u52309\u7ec4\u6210\u7684\u9a8c\u8bc1\u7801\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7",(0,s.jsx)(n.code,{children:"codeSet"}),"\u914d\u7f6e\u8bbe\u7f6e\u9a8c\u8bc1\u7801\u751f\u6210\u89c4\u5219\uff0c\u652f\u6301\u4ee5\u4e0b\u4e09\u79cd\u65b9\u6848\uff1a"]}),"\n",(0,s.jsx)(n.h4,{id:"\u9884\u8bbe\u5b57\u7b26\u96c6\u548c\u957f\u5ea6",children:"\u9884\u8bbe\u5b57\u7b26\u96c6\u548c\u957f\u5ea6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"createCaptchaProvider({\n  // ...\n  codeSet: ['A', 'B', 'C', 1, 2, 3]\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u4f60\u6709\u53ef\u4ee5\u4ee5\u901a\u8fc7",(0,s.jsx)(n.code,{children:"codeSet"}),"\u914d\u7f6e\u8bbe\u7f6e\u5b57\u7b26\u96c6\u548c\u957f\u5ea6\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"createCaptchaProvider({\n  // ...\n  codeSet: {\n    chars: ['A', 'B', 'C', 1, 2, 3], // \u53ef\u9009\n    length: 6 // \u751f\u62106\u4f4d\u9a8c\u8bc1\u7801\uff0c\u53ef\u9009\n  }\n});\n"})}),"\n",(0,s.jsx)(n.h4,{id:"\u5b8c\u5168\u81ea\u5b9a\u4e49\u751f\u6210\u903b\u8f91",children:"\u5b8c\u5168\u81ea\u5b9a\u4e49\u751f\u6210\u903b\u8f91"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e5f\u53ef\u4ee5\u5c06",(0,s.jsx)(n.code,{children:"codeSet"}),"\u6307\u5b9a\u4e3a\u51fd\u6570\uff0c\u81ea\u5b9a\u4e49\u751f\u6210\u89c4\u5219\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"createCaptchaProvider({\n  codeSet: () => {\n    // \u751f\u6210\u5305\u542b\u6821\u9a8c\u4f4d\u7684\u9a8c\u8bc1\u7801\n    const baseCode = Math.random().toString().slice(2, 6);\n    const checksum = baseCode.split('').reduce((a, b) => a + +b, 0) % 10;\n    return baseCode + checksum; // \u5982\"24682\"\n  }\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49\u5b58\u50a8key\u524d\u7f00",children:"\u81ea\u5b9a\u4e49\u5b58\u50a8key\u524d\u7f00"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e3a\u4e86\u9632\u6b62\u4e0e\u5df2\u5b58\u5728\u7684\u5b58\u50a8\u952e\u51b2\u7a81\uff0c\u53ef\u4ee5\u901a\u8fc7",(0,s.jsx)(n.code,{children:"keyPrefix"}),"\u914d\u7f6e\u8bbe\u7f6e\u5b58\u50a8\u952e\u524d\u7f00\uff0c\u9ed8\u8ba4\u4e3a",(0,s.jsx)(n.code,{children:"alova-captcha"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"createCaptchaProvider({\n  // ...\n  keyPrefix: 'payment-system'\n});\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);