"use strict";(globalThis.webpackChunkalova_website=globalThis.webpackChunkalova_website||[]).push([[3597],{26871(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"api/states","title":"Response Status Operation","description":"updateState","source":"@site/docs/api/05-states.md","sourceDirName":"api","slug":"/api/states","permalink":"/api/states","draft":false,"unlisted":false,"editUrl":"https://github.com/alovajs/alovajs.github.io/blob/main/docs/api/05-states.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Response Status Operation"},"sidebar":"api","previous":{"title":"Cache Operations","permalink":"/api/cache"},"next":{"title":"Global Configuration","permalink":"/api/global-config"}}');var s=n(74848),o=n(28453);const r={title:"Response Status Operation"},i=void 0,d={},l=[{value:"updateState",id:"updatestate",level:2}];function c(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h2,{id:"updatestate",children:"updateState"}),"\n",(0,s.jsx)(t.p,{children:"Manually update the existing response data or additional status under any module/page."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u26a0\ufe0f Make sure the component is not destroyed"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"updateState"})," will search for the response status created by alova's useHooks when sending a request by default, but to prevent memory overflow, the destruction of a component will also recycle all the status created inside it. Therefore, when using ",(0,s.jsx)(t.code,{children:"updateState"}),", make sure that the container component corresponding to the response status you want to update is not destroyed, otherwise the corresponding response status will not be found and the update will fail."]}),"\n",(0,s.jsx)(t.p,{children:"This problem often occurs when updating state across pages, because when the page jumps, we tend to overlook that the previous page has been destroyed by default. Therefore, if you want to update the state across pages, here are two suggestions:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Persist the page components to ensure that the updated state can still be found;"}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Use ",(0,s.jsx)(t.a,{href:"/tutorial/cache/set-and-query",children:"setCache"})," instead of ",(0,s.jsx)(t.code,{children:"updateState"}),". The principle is that when the request of the previous page is cached, update its cache to ensure that when the page is created again, the triggered request can hit the updated cache and achieve the same effect."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:["Go to ",(0,s.jsx)(t.a,{href:"/tutorial/client/in-depth/update-across-components",children:"Update response status across pages/modules"})," for details."]}),"\n"]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:["For managing additional states using updateState, please refer to ",(0,s.jsx)(t.a,{href:"/tutorial/client/in-depth/manage-extra-states",children:"Extra state management"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.strong,{children:"Type"})}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"function updateState(\n  matcher: Method,\n  handleUpdate: UpdateStateCollection<Response>['data'] | UpdateStateCollection<Response>,\n  options?: UpdateOptions\n): boolean;\n"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Parameter"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"matcher"}),": The value is a method instance."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"handleUpdate"}),": Update function or update function collection. If it is a function collection, the corresponding update function on the collection will be called and the return value will be used as the update result."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Return"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Whether the update is successful."}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.strong,{children:"Example"})}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Use ",(0,s.jsx)(t.code,{children:"useRequest"})," in page or component A to send a request and get the response data."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"const { data } = useRequest(\n  alova.Get('/api/user', {\n    name: 'user'\n  })\n);\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Use ",(0,s.jsx)(t.code,{children:"updateState"})," in page or component B to update the response status."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"import { updateState } from 'alova';\n\n// match by method instance\nupdateState(alova.Get('/api/user'), oldData => {\n  return [\n   ...oldData,\n    {\n      id: 10000,\n      name: 'Alova',\n    },\n  ]\n});\n\n// match by method name\nconst methodSnapshot = alova.snapshots.match('user', true);\nupdateState(methodSnapshot, oldData => {\n  return [\n  ...oldData,\n    {\n      id: 10000,\n      name: 'Alova',\n    },\n  ];\n}\n\n// match by regexp of method name\nconst methodSnapshot = alova.snapshots.match(/^us/, true);\nupdateState(methodSnapshot, oldData => {\n  return [\n  ...oldData,\n    {\n      id: 10000,\n      name: 'Alova',\n    },\n  ];\n})\n\n// match by method matcher and filter\nconst methodSnapshot = alova.snapshots.match({\n  name: 'user',\n  filter(method, i, methods) {\n    return methods.length === i + 1;\n  }\n}, true);\nupdateState(methodSnapshot, oldData => {\n  return [\n ...oldData,\n    {\n      id: 10000,\n      name: 'Alova',\n    },\n  ];\n});\n"})})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453(e,t,n){n.d(t,{R:()=>r,x:()=>i});var a=n(96540);const s={},o=a.createContext(s);function r(e){const t=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(o.Provider,{value:t},e.children)}}}]);