"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[9430],{17907:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var a=t(85893),r=t(11151);const s={title:"Server Usage"},o=void 0,c={id:"tutorial/getting-started/basic/server",title:"Server Usage",description:"As mentioned in the previous Quick Start, alova can be used in server-side environments such as nodejs/deno/bun. You can use all functions except client request strategies on the server. In addition, alova also provides good support for server-side environments.",source:"@site/docs/tutorial/02-getting-started/03-basic/08-server.md",sourceDirName:"tutorial/02-getting-started/03-basic",slug:"/tutorial/getting-started/basic/server",permalink:"/tutorial/getting-started/basic/server",draft:!1,unlisted:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/tutorial/02-getting-started/03-basic/08-server.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Server Usage"},sidebar:"tutorial",previous:{title:"Combine UI framework",permalink:"/tutorial/getting-started/basic/combine-framework"},next:{title:"OpenAPI integration",permalink:"/tutorial/getting-started/openapi-integration"}},i={},l=[{value:"Server hooks",id:"server-hooks",level:2},{value:"Multi-level Cache",id:"multi-level-cache",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["As mentioned in the previous ",(0,a.jsx)(n.a,{href:"/tutorial/getting-started/quick-start",children:"Quick Start"}),", alova can be used in server-side environments such as ",(0,a.jsx)(n.code,{children:"nodejs/deno/bun"}),". You can use all functions except client request strategies on the server. In addition, alova also provides good support for server-side environments."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"import { createAlova } from 'alova';\nimport adapterFetch from 'alova/fetch';\n\nconst alovaInstance = createAlova({\nrequestAdapter: adapterFetch()\n});\n\nalovaInstance.Get(...);\nalovaInstance.Post(...);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"server-hooks",children:"Server hooks"}),"\n",(0,a.jsxs)(n.p,{children:["On the server, we also have different request scenarios, such as request retries, calling APIs to send verification codes, etc., which we call ",(0,a.jsx)(n.code,{children:"Server hooks"}),". They are decorated functions of method instances, and multiple ",(0,a.jsx)(n.code,{children:"Server hooks"})," can be used in combination."]}),"\n",(0,a.jsxs)(n.p,{children:["The following is an example that combines ",(0,a.jsx)(n.code,{children:"retry"})," and ",(0,a.jsx)(n.code,{children:"sendCaptcha"}),", which implements sending verification codes by retrying after failure:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const { retry, createCaptchaProvider } = require('alova/server');\n\nconst { sendCaptcha } = createCaptchaProvider({\n  store: redisAdapter\n});\n\n// step1: create a method instance to send code.\nconst createCaptchaMethod = (code, key) = > alovaInstance.Post('/api/captcha', {\n  code,\n  email: key,\n});\n\n// step2: wrap `createCaptchaMethod` with sendCaptcha hook.\nconst captchaMethod = sendCaptcha(createCaptchaMethod, {\n  key: 'xxx@xxx.com'\n});\n\n// step3: wrap `captchaMethod` with retry hook, and get the response result through `await`\nconst result = await retry(captchaMethod, {\n  retry: 3,\n  backoff: {\n    delay: 2000\n  }\n});\n"})}),"\n",(0,a.jsxs)(n.p,{children:["You can also use multiple ",(0,a.jsx)(n.code,{children:"server hooks"})," to wrap method instances directly."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const result = await retry(\n  sendCaptcha(\n    (code, key) =>\n      alovaInstance.Post('/api/captcha', {\n        email,\n        content: 'captcha content'\n      }),\n    { key: 'xxx@xxx.com' }\n  ),\n  {\n    retry: 3,\n    backoff: {\n      delay: 2000\n    }\n  }\n);\n"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["For more ",(0,a.jsx)(n.code,{children:"Server hooks"}),", please visit ",(0,a.jsx)(n.a,{href:"/tutorial/server/strategy",children:"Server Strategy"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"multi-level-cache",children:"Multi-level Cache"}),"\n",(0,a.jsx)(n.p,{children:"alova provides a complete and simple cache function. Not only that, it also supports multi-level cache to provide the fastest request experience for your server application. You can freely choose to use single-level cache or multi-level cache. Their operating mechanisms are as follows:"}),"\n",(0,a.jsx)(n.mermaid,{value:"flowchart LR\nA[User request] --\x3e B{Check L1 cache}\nB --\x3e|Hit| C[Return data]\nB --\x3e|Miss| D{Check L2 cache}\nD --\x3e|Hit| E[Update L1 cache]\nE --\x3e C\nD --\x3e|Miss| F[Request API interface]\nF --\x3e G[Update L2 cache]\nG --\x3e E\nC --\x3e H[End]\n\nstyle F stroke-width:8px"}),"\n",(0,a.jsx)(n.p,{children:"Some application scenarios are as follows:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"High access frequency and low latency requirements: such as popular news and product details, which can further reduce network overhead and maintain faster response when the network is unstable."}),"\n",(0,a.jsx)(n.li,{children:"Reduce the pressure on downstream servers, such as services with peak access periods, and the upper-level cache can effectively reduce the pressure on the backend database and microservices."}),"\n",(0,a.jsx)(n.li,{children:"Integrate data merging and processing of multiple downstream servers. Multiple serial requests may lead to longer response time and may consume performance due to complex data conversion. The converted data can be cached."}),"\n",(0,a.jsx)(n.li,{children:"API rate limit and billing. Weather forecast service API updates weather information every hour, geographic location data API, etc."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"By default, alova's first-level cache is a simple object cache in a key-value manner, without a second-level cache. You can configure it yourself. The following is an example of using an inter-process memory sharing adapter plus lru cache as the first-level cache and redis as the second-level cache."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const { createPSCAdapter, NodeSyncAdapter } = require('@alova/psc');\nconst { LRUCache } = require('lru-cache');\nconst RedisStorageAdapter = require('./adapter-redis');\n\nfunction lRUCache(options = {}) {\n  const cache = new LRUCache(options);\n  return {\n    set(key, value) {\n      return cache.set(key, value);\n    },\n\n    get(key) {\n      return cache.get(key);\n    },\n\n    remove(key) {\n      return cache.delete(key);\n    },\n\n    clear() {\n      return cache.clear();\n    }\n  };\n}\n\nconst alovaInstance = createAlova({\n  baseURL: 'https://api.alovajs.dev',\n\n  // Inter-process shared cache adapter\n  l1Cache: createPSCAdapter(\n    NodeSyncAdapter(),\n    lRUCache({\n      max: 1000,\n      ttl: 1000 * 60 * 10\n    })\n  ),\n\n  // redis cache adapter\n  l2Cache: new RedisStorageAdapter({\n    host: 'localhost',\n    port: 6379,\n    username: 'default',\n    password: 'my-top-secret',\n    db: 0\n  })\n});\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The source code of the redis adapter mentioned above can be found in ",(0,a.jsx)(n.a,{href:"/tutorial/project/best-practice/l2-storage",children:"Best Practice - L2 Cache Adapter"}),", and the adapter for shared memory between processes can be found here(/resource/storage-adapter/psc)"]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["For more detail of response cache, please refer to ",(0,a.jsx)(n.a,{href:"/tutorial/cache/mode",children:"Detailed Explanation of Cache"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>c,a:()=>o});var a=t(67294);const r={},s=a.createContext(r);function o(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);