"use strict";(globalThis.webpackChunkalova_website=globalThis.webpackChunkalova_website||[]).push([[7312],{11470(e,n,t){t.d(n,{A:()=>q});var a=t(96540),s=t(34164),r=t(17559),o=t(23104),i=t(56347),l=t(205),d=t(57485),c=t(31682),u=t(70679);function h(e){return a.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,a.useMemo)(()=>{const e=n??function(e){return h(e).map(({props:{value:e,label:n,attributes:t,default:a}})=>({value:e,label:n,attributes:t,default:a}))}(t);return function(e){const n=(0,c.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function m({value:e,tabValues:n}){return n.some(n=>n.value===e)}function f({queryString:e=!1,groupId:n}){const t=(0,i.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,d.aZ)(s),(0,a.useCallback)(e=>{if(!s)return;const n=new URLSearchParams(t.location.search);n.set(s,e),t.replace({...t.location,search:n.toString()})},[s,t])]}function v(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,r=p(e),[o,i]=(0,a.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:r})),[d,c]=f({queryString:t,groupId:s}),[h,v]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,s]=(0,u.Dv)(n);return[t,(0,a.useCallback)(e=>{n&&s.set(e)},[n,s])]}({groupId:s}),x=(()=>{const e=d??h;return m({value:e,tabValues:r})?e:null})();(0,l.A)(()=>{x&&i(x)},[x]);return{selectedValue:o,selectValue:(0,a.useCallback)(e=>{if(!m({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);i(e),c(e),v(e)},[c,v,r]),tabValues:r}}var x=t(92303);const g="tabList__CuJ",b="tabItem_LNqP";var j=t(74848);function y({className:e,block:n,selectedValue:t,selectValue:a,tabValues:r}){const i=[],{blockElementScrollPositionUntilNextRender:l}=(0,o.a_)(),d=e=>{const n=e.currentTarget,s=i.indexOf(n),o=r[s].value;o!==t&&(l(n),a(o))},c=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=i.indexOf(e.currentTarget)+1;n=i[t]??i[0];break}case"ArrowLeft":{const t=i.indexOf(e.currentTarget)-1;n=i[t]??i[i.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:r.map(({value:e,label:n,attributes:a})=>(0,j.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{i.push(e)},onKeyDown:c,onClick:d,...a,className:(0,s.A)("tabs__item",b,a?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function w({lazy:e,children:n,selectedValue:t}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find(e=>e.props.value===t);return e?(0,a.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:r.map((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function T(e){const n=v(e);return(0,j.jsxs)("div",{className:(0,s.A)(r.G.tabs.container,"tabs-container",g),children:[(0,j.jsx)(y,{...n,...e}),(0,j.jsx)(w,{...n,...e})]})}function q(e){const n=(0,x.A)();return(0,j.jsx)(T,{...e,children:h(e.children)},String(n))}},19365(e,n,t){t.d(n,{A:()=>o});t(96540);var a=t(34164);const s="tabItem_Ymn6";var r=t(74848);function o({children:e,hidden:n,className:t}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,a.A)(s,t),hidden:n,children:e})}},28453(e,n,t){t.d(n,{R:()=>o,x:()=>i});var a=t(96540);const s={},r=a.createContext(s);function o(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(r.Provider,{value:n},e.children)}},79239(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>p,frontMatter:()=>l,metadata:()=>a,toc:()=>u});const a=JSON.parse('{"id":"resource/request-adapter/xhr","title":"XMLHttpRequest Adapter","description":"Install","source":"@site/docs/resource/01-request-adapter/03-xhr.md","sourceDirName":"resource/01-request-adapter","slug":"/resource/request-adapter/xhr","permalink":"/resource/request-adapter/xhr","draft":false,"unlisted":false,"editUrl":"https://github.com/alovajs/alovajs.github.io/blob/main/docs/resource/01-request-adapter/03-xhr.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"XMLHttpRequest Adapter"},"sidebar":"resource","previous":{"title":"Fetch Adapter","permalink":"/resource/request-adapter/fetch"},"next":{"title":"axios adapter","permalink":"/resource/request-adapter/axios"}}');var s=t(74848),r=t(28453),o=t(11470),i=t(19365);const l={title:"XMLHttpRequest Adapter"},d=void 0,c={},u=[{value:"Install",id:"install",level:2},{value:"Instructions",id:"instructions",level:2},{value:"create alova",id:"create-alova",level:3},{value:"Request",id:"request",level:3},{value:"Upload",id:"upload",level:3},{value:"download",id:"download",level:3},{value:"Content-Type Handling",id:"content-type-handling",level:2},{value:"Automatic Form Urlencode",id:"automatic-form-urlencode",level:2},{value:"Mock request adapter compatible",id:"mock-request-adapter-compatible",level:2},{value:"Typescript",id:"typescript",level:2},{value:"method configuration",id:"method-configuration",level:3},{value:"Response data",id:"response-data",level:3}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"install",children:"Install"}),"\n",(0,s.jsxs)(o.A,{children:[(0,s.jsx)(i.A,{value:"1",label:"npm",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install alova @alova/adapter-xhr --save\n"})})}),(0,s.jsx)(i.A,{value:"2",label:"yarn",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"yarn add alova @alova/adapter-xhr\n"})})}),(0,s.jsx)(i.A,{value:"3",label:"pnpm",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm install alova @alova/adapter-xhr\n"})})})]}),"\n",(0,s.jsx)(n.h2,{id:"instructions",children:"Instructions"}),"\n",(0,s.jsx)(n.h3,{id:"create-alova",children:"create alova"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.strong,{children:"xhrRequestAdapter"})," as request adapter for alova."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { createAlova } from 'alova';\nimport { xhrRequestAdapter } from '@alova/adapter-xhr';\n\nconst alovaInst = createAlova({\n  //...\n  requestAdapter: xhrRequestAdapter()\n  //...\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When you need to access the internal XMLHttpRequest instance, you can get the instance through the ",(0,s.jsx)(n.code,{children:"create"})," callback function."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const alovaInst = createAlova({\n  // ...\n  requestAdapter: xhrRequestAdapter({\n    onCreate(xhr) {\n      // Access xhr instance\n      // ...\n    }\n  })\n  // ...\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"request",children:"Request"}),"\n",(0,s.jsxs)(n.p,{children:["The XMLHttpRequest adapter provides basic configuration parameters, including ",(0,s.jsx)(n.code,{children:"responseType"}),", ",(0,s.jsx)(n.code,{children:"withCredentials"}),", ",(0,s.jsx)(n.code,{children:"mimeType"}),", ",(0,s.jsx)(n.code,{children:"auth"}),", as follows:"]}),"\n",(0,s.jsxs)(o.A,{groupId:"framework",children:[(0,s.jsx)(i.A,{value:"1",label:"vue",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<template>\n  <div v-if="loading">Loading...</div>\n  <div>The request data is: {{ data }}</div>\n</template>\n\n<script setup>\n  const list = () =>\n    alovaInst.Get(\'/list\', {\n      /**\n       * Set the response data type\n       * Can be set to change the response type. Values are: "arraybuffer", "blob", "document", "json" and "text"\n       * defaults to "json"\n       */\n      responseType: \'text\',\n\n      /**\n       * True when credentials are to be included in cross-origin requests. false when they are excluded from cross-origin requests and when cookies are ignored in their responses. Default is false\n       */\n      withCredentials: true,\n\n      /**\n       * Set the mimeType of the response data\n       */\n      mimeType: \'text/plain; charset=x-user-defined\',\n\n      /**\n       * auth means use HTTP Basic authentication and provide credentials.\n       * This will set an `Authorization` header, overriding any existing\n       * Custom headers for `Authorization` set using `headers`.\n       * Note that only HTTP Basic authentication can be configured via this parameter.\n       * For Bearer tokens etc., use the `Authorization` custom header instead.\n       */\n      auth: {\n        username: \'name1\',\n        password: \'123456\'\n      }\n    });\n  const { loading, data } = useRequest(list);\n<\/script>\n'})})}),(0,s.jsx)(i.A,{value:"2",label:"react",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:'const list = () =>\n   alovaInst.Get(\'/list\', {\n     /**\n        * Set the response data type\n        * Can be set to change the response type. Values are: "arraybuffer", "blob", "document", "json" and "text"\n        * defaults to "json"\n        */\n       responseType: \'text\',\n\n       /**\n        * True when credentials are to be included in cross-origin requests. false when they are excluded from cross-origin requests and when cookies are ignored in their responses. Default is false\n        */\n       withCredentials: true,\n\n       /**\n        * Set the mimeType of the response data\n        */\n       mimeType: \'text/plain; charset=x-user-defined\',\n\n       /**\n        * auth means use HTTP Basic authentication and provide credentials.\n        * This will set an `Authorization` header, overriding any existing\n        * Custom headers for `Authorization` set using `headers`.\n        * Note that only HTTP Basic authentication can be configured via this parameter.\n        * For Bearer tokens etc., use the `Authorization` custom header instead.\n        */\n       auth: {\n         username: \'name1\',\n         password: \'123456\'\n       }\n   });\n\nconst App = () => {\n   const { loading, data } = useRequest(list);\n\n   return (\n     { loading ? <div>Loading...</div> : null }\n     <div>The request data is: { JSON.stringify(data) }</div>\n   )\n};\n'})})}),(0,s.jsx)(i.A,{value:"3",label:"svelte",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<script>\n  const list = () =>\n    alovaInst.Get(\'/list\', {\n      /**\n       * Set the response data type\n       * Can be set to change the response type. Values are: "arraybuffer", "blob", "document", "json" and "text"\n       * defaults to "json"\n       */\n      responseType: \'text\',\n\n      /**\n       * True when credentials are to be included in cross-origin requests. false when they are excluded from cross-origin requests and when cookies are ignored in their responses. Default is false\n       */\n      withCredentials: true,\n\n      /**\n       * Set the mimeType of the response data\n       */\n      mimeType: \'text/plain; charset=x-user-defined\',\n\n      /**\n       * auth means use HTTP Basic authentication and provide credentials.\n       * This will set an `Authorization` header, overriding any existing\n       * Custom headers for `Authorization` set using `headers`.\n       * Note that only HTTP Basic authentication can be configured via this parameter.\n       * For Bearer tokens etc., use the `Authorization` custom header instead.\n       */\n      auth: {\n        username: \'name1\',\n        password: \'123456\'\n      }\n    });\n  const { loading, data } = useRequest(list);\n<\/script>\n\n{#if $loading}\n<div>Loading...</div>\n{/if}\n<div>The request data is: { data }</div>\n'})})})]}),"\n",(0,s.jsx)(n.h3,{id:"upload",children:"Upload"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"FormData"})," to upload files, and this ",(0,s.jsx)(n.code,{children:"FormData"})," instance will be sent to the server through ",(0,s.jsx)(n.code,{children:"xhr.send"}),". It will be set ",(0,s.jsx)(n.code,{children:"Content-Type"})," automatically, you don't need to custom it with ",(0,s.jsx)(n.code,{children:"multipart/form-data"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const uploadFile = imageFile => {\n  const formData = new FormData();\n  formData.append('file', imageFile);\n  return alovaInst.Post('/uploadImg', formData);\n};\n\nconst {\n  loading,\n  data,\n  uploading,\n  send: sendUpload\n} = useRequest(uploadFile, {\n  immediate: false\n});\n\n// Picture selection event callback\nconst handleImageChoose = ({ target }) => {\n  sendUpload(target.files[0]);\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"download",children:"download"}),"\n",(0,s.jsx)(n.p,{children:"Point the request url to the file address to download."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const downloadFile = () =>\n  alovaInst.Get('/bigImage.jpg', {\n    responseType: 'blob'\n  });\n\nconst { loading, data, downloading, send, onSuccess } = useRequest(downloadFile, {\n  immediate: false\n});\nonSuccess(({ data: imageBlob }) => {\n  // download image\n  const anchor = document.createElement('a');\n  anchor.href = URL.createObjectURL(blob);\n  anchor.download = 'image.jpg';\n  anchor.click();\n  URL.revokeObjectURL(anchor.href);\n});\nconst handleImageDownload = () => {\n  send();\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"content-type-handling",children:"Content-Type Handling"}),"\n",(0,s.jsxs)(n.p,{children:["The xhr adapter defaults to ",(0,s.jsx)(n.code,{children:"application/json;charset=UTF-8"})," when no ",(0,s.jsx)(n.code,{children:"Content-Type"})," header is specified and the request body data is not ",(0,s.jsx)(n.code,{children:"FormData"}),". You can override the default behavior by setting the ",(0,s.jsx)(n.code,{children:"Content-Type"})," header."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"alovaInstance.Post(\n  '/todo/create',\n  { title: 'New Todo' },\n  {\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded'\n    }\n  }\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"[v3.4.0+]"}),"If you do not want to set the default ",(0,s.jsx)(n.code,{children:"Content-Type"}),", you can set ",(0,s.jsx)(n.code,{children:"Content-Type"})," to a falsy value, i.e., ",(0,s.jsx)(n.code,{children:"undefined"}),", ",(0,s.jsx)(n.code,{children:"null"}),", ",(0,s.jsx)(n.code,{children:"false"}),", or an empty string."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"alovaInstance.Post(\n  '/todo/create',\n  { title: 'New Todo' },\n  {\n    headers: {\n      'Content-Type': undefined\n    }\n  }\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"automatic-form-urlencode",children:"Automatic Form Urlencode"}),"\n",(0,s.jsxs)(n.p,{children:["When using ",(0,s.jsx)(n.code,{children:"application/x-www-form-urlencoded"})," as the request header, the XHR adapter automatically converts request body data to the ",(0,s.jsx)(n.code,{children:"key1=value1&key2=value2"})," string format, eliminating the need for manual conversion."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"alovaInstance.Post(\n  '/todo/create',\n  { title: 'New Todo', completed: false },\n  {\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded'\n    }\n  }\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The above request will convert the request body data to a string in the format ",(0,s.jsx)(n.code,{children:"title=New%20Todo&completed=false"})," and send it to the server."]}),"\n",(0,s.jsx)(n.h2,{id:"mock-request-adapter-compatible",children:"Mock request adapter compatible"}),"\n",(0,s.jsxs)(n.p,{children:["When developing applications, we may still need to use simulated requests. Only by default, the response data of ",(0,s.jsx)(n.a,{href:"/resource/request-adapter/alova-mock",children:"Mock Request Adapter (@alova/mock)"})," is a ",(0,s.jsx)(n.code,{children:"Response"})," instance, which is compatible with the ",(0,s.jsx)(n.code,{children:"alova/fetch"})," request adapter by default. When using the XMLHttpRequest adapter, we You need to adapt the response data of the mock request adapter to the XMLHttpRequest adapter. In this case, you need to use the ",(0,s.jsx)(n.code,{children:"xhrMockResponse"})," exported in the ",(0,s.jsx)(n.strong,{children:"@alova/adapter-xhr"})," package as the response adapter."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { defineMock, createAlovaMockAdapter } from '@alova/mock';\nimport { xhrRequestAdapter, xhrMockResponse } from '@alova/adapter-xhr';\n\nconst mocks = defineMock({\n  //...\n});\n\n// mock data request adapter\nexport default createAlovaMockAdapter([mocks], {\n  // After specifying the request adapter, requests that do not match the simulated interface will use this adapter to send requests\n  httpAdapter: xhrRequestAdapter(),\n\n  // Use xhrMockResponse to adapt the simulated data to the XMLHttpRequest adapter\n  onMockResponse: xhrMockResponse\n});\n\nexport const alovaInst = createAlova({\n  //...\n  // Control whether to use the simulated request adapter through environment variables\n  requestAdapter: process.env.NODE_ENV === 'development' ? mockAdapter : xhrRequestAdapter()\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"typescript",children:"Typescript"}),"\n",(0,s.jsx)(n.p,{children:"The XMLHttpRequest request adapter provides complete type adaptation."}),"\n",(0,s.jsx)(n.h3,{id:"method-configuration",children:"method configuration"}),"\n",(0,s.jsxs)(n.p,{children:["When creating a method instance, in addition to the common configuration items in the method, you can also use the configuration items in ",(0,s.jsx)(n.code,{children:"AlovaXHRRequestConfig"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'/**\n * xhr request configuration parameters\n */\ninterface AlovaXHRRequestConfig {\n  /**\n   * Set the response data type.\n   *\n   * Can be set to change the response type. Values are: "arraybuffer", "blob", "document", "json", and "text".\n   * Setting 1: If the current global object is not a Window object, the setting to "document" is ignored.\n   * Setup 2: Throw an "InvalidStateError" DOMException if the state is loading or complete.\n   * Setting 3: Throws an "InvalidAccessError" DOMException if the sync flag is set and the current global object is a Window object.\n   * @default "json"\n   */\n  responseType?: XMLHttpRequestResponseType;\n\n  /**\n   * True when credentials are to be included in cross-origin requests. false when they are excluded from cross-origin requests and when cookies are ignored in their responses. The default is false.\n   * An \'InvalidStateError\' DOMException is thrown if the state is not sent or not opened, or if the send() flag is set.\n   * @default false\n   */\n  withCredentials?: boolean;\n\n  /**\n   * Set the mimeType of the response data\n   */\n  mimeType?: string;\n\n  /**\n   * `auth` indicates that HTTP Basic authentication should be used, and credentials are provided.\n   * This will set an `Authorization` header, overriding any existing\n   * Custom headers for `Authorization` set using `headers`.\n   * Note that only HTTP Basic authentication can be configured via this parameter.\n   * For Bearer tokens etc., use the `Authorization` custom header instead.\n   */\n  auth?: {\n    username: string;\n    password: string;\n  };\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"response-data",children:"Response data"}),"\n",(0,s.jsx)(n.p,{children:"XMLHttpRequest adapter response data is as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface AlovaXHRResponseHeaders {\n  [x: string]: any;\n}\ninterface AlovaXHRResponse<T = any> {\n  status: number;\n  statusText: string;\n  data: T;\n  headers: AlovaXHRResponseHeaders;\n}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);