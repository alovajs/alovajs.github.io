"use strict";(self.webpackChunkalova_website=self.webpackChunkalova_website||[]).push([[5823],{38609:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>c,toc:()=>u});var a=n(85893),s=n(11151),r=n(74866),i=n(85162);const o={title:"Server-Side Rendering (SSR)"},l=void 0,c={id:"tutorial/advanced/in-depth/ssr",title:"Server-Side Rendering (SSR)",description:"Overview",source:"@site/docs/tutorial/06-advanced/01-in-depth/09-ssr.md",sourceDirName:"tutorial/06-advanced/01-in-depth",slug:"/tutorial/advanced/in-depth/ssr",permalink:"/tutorial/advanced/in-depth/ssr",draft:!1,unlisted:!1,editUrl:"https://github.com/alovajs/alovajs.github.io/blob/main/docs/tutorial/06-advanced/01-in-depth/09-ssr.md",tags:[],version:"current",sidebarPosition:9,frontMatter:{title:"Server-Side Rendering (SSR)"},sidebar:"tutorial",previous:{title:"Cache Logger",permalink:"/tutorial/advanced/in-depth/cache-logger"},next:{title:"Typescript",permalink:"/tutorial/advanced/in-depth/typescript"}},d={},u=[{value:"Overview",id:"overview",level:2},{value:"CSR mode in SSR",id:"csr-mode-in-ssr",level:2},{value:"SSR Frameworks",id:"ssr-frameworks",level:2},{value:"Nuxt3",id:"nuxt3",level:3},{value:"Setup the Nuxt adapter",id:"setup-the-nuxt-adapter",level:4},{value:"Fetch data on the server side",id:"fetch-data-on-the-server-side",level:4},{value:"Custom Serializer",id:"custom-serializer",level:4},{value:"Nextjs",id:"nextjs",level:3},{value:"Sveltekit",id:"sveltekit",level:3}];function h(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsxs)(t.p,{children:["To be compatible with server-side rendering of UI frameworks such as ",(0,a.jsx)(t.a,{href:"https://nuxt.com/",children:"Nuxt3"})," / ",(0,a.jsx)(t.a,{href:"https://nextjs.org/",children:"Nextjs"})," / ",(0,a.jsx)(t.a,{href:"https://kit.svelte.dev/",children:"sveltekit"}),", alova has made adaptations for them. Although frameworks like ",(0,a.jsx)(t.code,{children:"Nuxt3"})," and ",(0,a.jsx)(t.code,{children:"Sveltekit"})," offer built-in request capabilities, if you choose to use alova, you can manage requests on both the server and client sides with alova instead of using different request solutions on the server and client sides respectively."]}),"\n",(0,a.jsx)(t.h2,{id:"csr-mode-in-ssr",children:"CSR mode in SSR"}),"\n",(0,a.jsxs)(t.p,{children:["When the code runs on the server side, the ",(0,a.jsx)(t.code,{children:"useRequest"})," and ",(0,a.jsx)(t.code,{children:"useWatcher"})," and other use hooks in the component will not send requests, even if ",(0,a.jsx)(t.code,{children:"immediate"})," is set to ",(0,a.jsx)(t.code,{children:"true"}),". Instead, requests will be sent when the code runs in the browser. You can use all the features of alova as usual. This is a same behavior in all SSR frameworks."]}),"\n",(0,a.jsx)(t.p,{children:"However, there are differences when using each SSR framework. Now, we will demonstrate how to use them one by one."}),"\n",(0,a.jsx)(t.h2,{id:"ssr-frameworks",children:"SSR Frameworks"}),"\n",(0,a.jsx)(t.h3,{id:"nuxt3",children:"Nuxt3"}),"\n",(0,a.jsxs)(t.p,{children:["In Nuxt3, using ",(0,a.jsx)(t.code,{children:"useFetch"})," can synchronize data between the server and the browser. By using the states hook adapter for nuxt, a better experience can be achieved. When using almost all hooks such as ",(0,a.jsx)(t.code,{children:"useRequest"})," and ",(0,a.jsx)(t.code,{children:"useWatcher"}),", not only can data be synchronized on both ends to avoid duplicate requests on the client side, but also data such as ",(0,a.jsx)(t.code,{children:"Date"}),", ",(0,a.jsx)(t.code,{children:"Error"}),", and custom types can be synchronized. Let's take a look at how to use it."]}),"\n",(0,a.jsx)(t.h4,{id:"setup-the-nuxt-adapter",children:"Setup the Nuxt adapter"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",children:"import { createAlova } from 'alova';\nimport NuxtHook from 'alova/nuxt';\n\n\nexport const alovaInstance = createAlova({\n// ...\n  statesHook: NuxtHook({\n    nuxtApp: useNuxtApp // useNuxtApp must be specified })\n  });\n});\n"})}),"\n",(0,a.jsx)(t.h4,{id:"fetch-data-on-the-server-side",children:"Fetch data on the server side"}),"\n",(0,a.jsxs)(t.p,{children:["When using almost all hooks such as ",(0,a.jsx)(t.code,{children:"useRequest"})," and ",(0,a.jsx)(t.code,{children:"useWatcher"}),", data is fetched on the server side through ",(0,a.jsx)(t.code,{children:"await"}),". it has the following features:"]}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsx)(t.li,{children:"The server-side data will be synchronized to the states in browser, keeping the states on both ends in sync, and all states are reactive."}),"\n",(0,a.jsxs)(t.li,{children:["By default, it supports the serialization of ",(0,a.jsx)(t.code,{children:"Date"}),", ",(0,a.jsx)(t.code,{children:"Error"}),", and ",(0,a.jsx)(t.code,{children:"RegExp"})," object of data, and also supports the serialization of custom data."]}),"\n",(0,a.jsx)(t.li,{children:"No repeated initialization requests in the browser."}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-html",children:"<template>\n  <div v-if=\"error\">{{ error.message }}</div>\n  <div v-else>{{ data }}</div>\n</template>\n\n<script setup>\n  const todoList = () => alovaInstance.Get('/todo/list', {\n    headers: {\n      'Content-Type': 'application/json; charset=UTF-8'\n    }\n  });\n\n\n  // Note that `useRequest` uses `await`, otherwise the request will not be sent on the server side.\n  const { data, error } = await useRequest(todoList);\n<\/script>\n"})}),"\n",(0,a.jsxs)(t.p,{children:["You can also use the combination of ",(0,a.jsx)(t.code,{children:"useAsyncData + alova.Method"})," to complete the server-side data acquisition. This is no different from how you usually use ",(0,a.jsx)(t.code,{children:"useAsyncData"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-html",children:"<script setup>\n  // Return a promise in useAsyncData\n  const { data, pending, refresh } = await useAsyncData(async () => {\n    const response = await alovaInstance.Get('/todo/list', {\n      headers: {\n        'Content-Type': 'application/json; charset=UTF-8'\n      }\n    });\n    return response;\n  });\n<\/script>\n"})}),"\n",(0,a.jsx)(t.h4,{id:"custom-serializer",children:"Custom Serializer"}),"\n",(0,a.jsxs)(t.p,{children:["If you need to serialize custom data and synchronize them to client, you can specify it in the ",(0,a.jsx)(t.code,{children:"serializers"})," of the Nuxt adapter, for example, a custom serializer for a moment instance."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",children:"const momentSerializer = {\n  // forward is called during serialization\n  // It is necessary to determine whether it is a moment instance; if not, the target value is returned as undefined, indicating that it should not be processed.\n  forward: data => (moment.isMoment(data) ? data.valueOf() : undefined),\n\n  // The `backward` method is called during deserialization, and `data` is the value returned in `forward`.\n  backward: timestamp => moment(timestamp)\n};\n\ncreateAlova({\n  // ...\n  statesHook: NuxtHook({\n    nuxtApp: useNuxtApp,\n    // highlight-start\n    serializers: {\n      moment: momentSerializer\n    }\n    // highlight-end\n  })\n});\n"})}),"\n",(0,a.jsx)(t.h3,{id:"nextjs",children:"Nextjs"}),"\n",(0,a.jsxs)(r.Z,{children:[(0,a.jsxs)(i.Z,{value:"1",label:"App Router",children:[(0,a.jsx)(t.p,{children:"In the app router mode of Next.js, you can directly use method instances in asynchronous components."}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-jsx",children:"const App = async () => {\n  const data = await alovaInstance.Get('/todo/list', {\n    headers: {\n      'Content-Type': 'application/json; charset=UTF-8'\n    }\n  });\n  // then ... code\n  return data.map(item => (\n    <div>\n      <span>{item.title}</span>\n      <span>{item.time}</span>\n    </div>\n  ));\n};\n\nexport default App;\n"})})]}),(0,a.jsxs)(i.Z,{value:"2",label:"Pages Router",children:[(0,a.jsxs)(t.p,{children:["In the traditional pages router mode, Next.js provides fixed server-side data initialization functions such as ",(0,a.jsx)(t.code,{children:"getStaticProps"}),", ",(0,a.jsx)(t.code,{children:"getServerSideProps"}),", and ",(0,a.jsx)(t.code,{children:"getStaticPaths"}),", etc. You can directly call the API in the function by using the method instance as shown in the ",(0,a.jsx)(t.a,{href:"/tutorial/getting-started/quick-start",children:"Quick Start tutorial"}),"."]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-jsx",children:"export const getServerSideProps = async ctx => {\n  const list = await alovaInstance.Get('/todo/list', {\n    headers: {\n      'Content-Type': 'application/json; charset=UTF-8'\n    }\n  });\n  return {\n    props: {\n      list\n    }\n  };\n};\nexport default function App(props) {\n  return props.list.map(item => (\n    <div>\n      <span>{item.title}</span>\n      <span>{item.time}</span>\n    </div>\n  ));\n}\n"})})]})]}),"\n",(0,a.jsx)(t.h3,{id:"sveltekit",children:"Sveltekit"}),"\n",(0,a.jsxs)(t.p,{children:["Sveltekit also provides the ",(0,a.jsx)(t.code,{children:"load"})," function for initializing page data on the server side. You can also directly use the method instance in the function to call the interface. For example, you can call the interface in ",(0,a.jsx)(t.code,{children:"+page.server.js"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-javascript",metastring:"title=+page.server.js",children:"/** @type {import('./$types').PageServerLoad} */\nexport async function load({ params }) {\n  return {\n    list: alovaInstance.Get('/todo/list', {\n      headers: {\n        'Content-Type': 'application/json; charset=UTF-8'\n      }\n    })\n  };\n}\n"})})]})}function p(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},85162:(e,t,n)=>{n.d(t,{Z:()=>i});n(67294);var a=n(90512);const s={tabItem:"tabItem_Ymn6"};var r=n(85893);function i(e){let{children:t,hidden:n,className:i}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,a.Z)(s.tabItem,i),hidden:n,children:t})}},74866:(e,t,n)=>{n.d(t,{Z:()=>y});var a=n(67294),s=n(90512),r=n(12466),i=n(16550),o=n(20469),l=n(91980),c=n(67392),d=n(20812);function u(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??function(e){return u(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:s}}=e;return{value:t,label:n,attributes:a,default:s}}))}(n);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function p(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function v(e){let{queryString:t=!1,groupId:n}=e;const s=(0,i.k6)(),r=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(r),(0,a.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(s.location.search);t.set(r,e),s.replace({...s.location,search:t.toString()})}),[r,s])]}function m(e){const{defaultValue:t,queryString:n=!1,groupId:s}=e,r=h(e),[i,l]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:r}))),[c,u]=v({queryString:n,groupId:s}),[m,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[s,r]=(0,d.Nk)(n);return[s,(0,a.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:s}),x=(()=>{const e=c??m;return p({value:e,tabValues:r})?e:null})();(0,o.Z)((()=>{x&&l(x)}),[x]);return{selectedValue:i,selectValue:(0,a.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),f(e)}),[u,f,r]),tabValues:r}}var f=n(72389);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=n(85893);function b(e){let{className:t,block:n,selectedValue:a,selectValue:i,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.o5)(),d=e=>{const t=e.currentTarget,n=l.indexOf(t),s=o[n].value;s!==a&&(c(t),i(s))},u=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":n},t),children:o.map((e=>{let{value:t,label:n,attributes:r}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:a===t?0:-1,"aria-selected":a===t,ref:e=>l.push(e),onKeyDown:u,onClick:d,...r,className:(0,s.Z)("tabs__item",x.tabItem,r?.className,{"tabs__item--active":a===t}),children:n??t},t)}))})}function g(e){let{lazy:t,children:n,selectedValue:s}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===s));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:r.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==s})))})}function w(e){const t=m(e);return(0,j.jsxs)("div",{className:(0,s.Z)("tabs-container",x.tabList),children:[(0,j.jsx)(b,{...t,...e}),(0,j.jsx)(g,{...t,...e})]})}function y(e){const t=(0,f.Z)();return(0,j.jsx)(w,{...e,children:u(e.children)},String(t))}},11151:(e,t,n)=>{n.d(t,{Z:()=>o,a:()=>i});var a=n(67294);const s={},r=a.createContext(s);function i(e){const t=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);