"use strict";(globalThis.webpackChunkalova_website=globalThis.webpackChunkalova_website||[]).push([[9677],{15225(e,t,a){a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"tutorial/server/strategy/send-captcha","title":"Distributed captcha sending","description":"server hook","source":"@site/docs/tutorial/04-server/01-strategy/02-send-captcha.md","sourceDirName":"tutorial/04-server/01-strategy","slug":"/tutorial/server/strategy/send-captcha","permalink":"/tutorial/server/strategy/send-captcha","draft":false,"unlisted":false,"editUrl":"https://github.com/alovajs/alovajs.github.io/blob/main/docs/tutorial/04-server/01-strategy/02-send-captcha.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Distributed captcha sending"},"sidebar":"tutorial","previous":{"title":"Request retry strategy","permalink":"/tutorial/server/strategy/retry"},"next":{"title":"Request Rate Limit","permalink":"/tutorial/server/strategy/rate-limit"}}');var r=a(74848),c=a(28453);const s={title:"Distributed captcha sending"},i=void 0,o={},d=[{value:"Features",id:"features",level:2},{value:"Usage",id:"usage",level:2},{value:"Basic usage",id:"basic-usage",level:3},{value:"Set the captcha code storage",id:"set-the-captcha-code-storage",level:3},{value:"Captcha code expiration time",id:"captcha-code-expiration-time",level:3},{value:"Captcha code resend interval",id:"captcha-code-resend-interval",level:3},{value:"Captcha code overwriting prevention",id:"captcha-code-overwriting-prevention",level:3},{value:"Custom captcha code generation rules",id:"custom-captcha-code-generation-rules",level:3},{value:"Preset character set and length",id:"preset-character-set-and-length",level:4},{value:"Completely customize generation logic",id:"completely-customize-generation-logic",level:4},{value:"Custom storage key prefix",id:"custom-storage-key-prefix",level:3}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.admonition,{title:"type",type:"info",children:(0,r.jsx)(t.p,{children:"server hook"})}),"\n",(0,r.jsx)(t.p,{children:"Captcha code sending and captcha, support cluster management captcha code"}),"\n",(0,r.jsx)(t.h2,{id:"features",children:"Features"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Easy to use;"}),"\n",(0,r.jsx)(t.li,{children:"Support single machine, redis and other clusters to manage captcha codes;"}),"\n",(0,r.jsx)(t.li,{children:"Customize captcha code validity time and resend interval;"}),"\n",(0,r.jsx)(t.li,{children:"Captcha code anti-overwriting;"}),"\n",(0,r.jsx)(t.li,{children:"Customize captcha code rules;"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(t.h3,{id:"basic-usage",children:"Basic usage"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"// Create\nconst { sendCaptcha, verifyCaptcha } = createCaptchaProvider({\n  store: RedisAdapter()\n});\n\n// Send captcha code\nconst key = '1234567890';\nawait sendCaptcha(\n  (code, mobile) => alova.Post('/sms/send', { code, mobile }),\n  // Mobile phone number as storage key\n  { key }\n);\n\n// Verify captcha code\nconst captchaFromUserInput = '1234';\nconst isValid = await verifyCaptcha(captchaFromUserInput, key);\nconsole.log(isValid ? 'Captcha passed' : 'Captcha code error');\n"})}),"\n",(0,r.jsx)(t.h3,{id:"set-the-captcha-code-storage",children:"Set the captcha code storage"}),"\n",(0,r.jsxs)(t.p,{children:["Before using it, you need to configure the storage of the captcha code through the ",(0,r.jsx)(t.code,{children:"store"})," configuration. It is the storage adapter of Alova. If it is a single machine, you can use the file storage adapter, and in a distributed cluster, you can use the redis adapter. You can select the appropriate adapter in ",(0,r.jsx)(t.a,{href:"/resource/storage-adapter",children:"Storage Adapter"}),", or ",(0,r.jsx)(t.a,{href:"/tutorial/advanced/custom/storage-adapter",children:"Custom Storage Adapter"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"const redisAdapter = new RedisStorageAdapter({\n  host: 'localhost',\n  port: '6379',\n  username: 'default',\n  password: 'my-top-secret',\n  db: 0\n});\n\ncreateCaptchaProvider({\n  store: redisAdapter\n});\n"})}),"\n",(0,r.jsx)(t.h3,{id:"captcha-code-expiration-time",children:"Captcha code expiration time"}),"\n",(0,r.jsxs)(t.p,{children:["Use ",(0,r.jsx)(t.code,{children:"expireTime"})," to set the captcha code validity period, in milliseconds, default ",(0,r.jsx)(t.code,{children:"300000"})," (5 minutes)."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"createCaptchaProvider({\n  expireTime: 10 * 60 * 1000\n});\n"})}),"\n",(0,r.jsx)(t.h3,{id:"captcha-code-resend-interval",children:"Captcha code resend interval"}),"\n",(0,r.jsxs)(t.p,{children:["Use ",(0,r.jsx)(t.code,{children:"resetTime"})," to set the captcha code resend interval, in milliseconds, default ",(0,r.jsx)(t.code,{children:"60000"})," (1 minute)."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"createCaptchaProvider({\n  resetTime: 5 * 60 * 1000\n});\n"})}),"\n",(0,r.jsx)(t.h3,{id:"captcha-code-overwriting-prevention",children:"Captcha code overwriting prevention"}),"\n",(0,r.jsxs)(t.p,{children:["Use ",(0,r.jsx)(t.code,{children:"resendFormStore"})," to set whether to resend the existing captcha code from the storage to prevent the problem of inconsistent captcha codes caused by users sending multiple times."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"createCaptchaProvider({\n  // ...\n  resendFormStore: true\n});\n"})}),"\n",(0,r.jsx)(t.h3,{id:"custom-captcha-code-generation-rules",children:"Custom captcha code generation rules"}),"\n",(0,r.jsxs)(t.p,{children:["By default, 4 captcha codes consisting of 0 to 9 will be generated. You can set the captcha code generation rules through ",(0,r.jsx)(t.code,{children:"codeSet"})," configuration. The following three schemes are supported:"]}),"\n",(0,r.jsx)(t.h4,{id:"preset-character-set-and-length",children:"Preset character set and length"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"createCaptchaProvider({\n  // ...\n  codeSet: ['A', 'B', 'C', 1, 2, 3]\n});\n"})}),"\n",(0,r.jsxs)(t.p,{children:["You can set the character set and length through ",(0,r.jsx)(t.code,{children:"codeSet"})," configuration."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"createCaptchaProvider({\n  // ...\n  codeSet: {\n    chars: ['A', 'B', 'C', 1, 2, 3], // optional\n    length: 6 // Generate 6-digit captcha code, optional\n  }\n});\n"})}),"\n",(0,r.jsx)(t.h4,{id:"completely-customize-generation-logic",children:"Completely customize generation logic"}),"\n",(0,r.jsxs)(t.p,{children:["You can also specify ",(0,r.jsx)(t.code,{children:"codeSet"})," as a function to customize the generation rules."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"createCaptchaProvider({\n  codeSet: () => {\n    // Generate a captcha code containing a check digit\n    const baseCode = Math.random().toString().slice(2, 6);\n    const checksum = baseCode.split('').reduce((a, b) => a + +b, 0) % 10;\n    return baseCode + checksum; // such as \"24682\"\n  }\n});\n"})}),"\n",(0,r.jsx)(t.h3,{id:"custom-storage-key-prefix",children:"Custom storage key prefix"}),"\n",(0,r.jsxs)(t.p,{children:["To prevent conflicts with existing storage keys, you can set the storage key prefix through the ",(0,r.jsx)(t.code,{children:"keyPrefix"})," configuration, which defaults to ",(0,r.jsx)(t.code,{children:"alova-captcha"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"createCaptchaProvider({\n  // ...\n  keyPrefix: 'payment-system'\n});\n"})})]})}function h(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453(e,t,a){a.d(t,{R:()=>s,x:()=>i});var n=a(96540);const r={},c=n.createContext(r);function s(e){const t=n.useContext(c);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),n.createElement(c.Provider,{value:t},e.children)}}}]);